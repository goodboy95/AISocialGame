这份设计方案将聚焦于\*\*“狼人杀”**这一特定游戏模块的详细落地。设计目标是构建一个专业、流畅、沉浸感强的**多人在线社交推理空间\*\*。

虽然底层技术支持 AI 补位，但在界面和交互设计上，我们将其包装为**标准的竞技游戏体验**，让 AI 的存在感服务于游戏流畅度（如“自动托管”或“补位选手”），而非强调其机器属性。

-----

# 🐺 狼人杀游戏模块 - 详细设计方案

## 1\. “创建房间”页面设计 (The Configurator)

**设计目标**：在满足高度自定义的同时，降低新手开局的认知门槛。

### 1.1 页面布局

  * **左侧：基础信息**

      * **房间封面/主题**：提供几张预设背景图（如：阴森古堡、迷雾森林、赛博都市）。
      * **房间名称**：输入框（默认：“[玩家名]的狼人杀局”）。
      * **隐私设置**：公开（大厅可见）/ 私密（仅链接/密码进入）。
      * **交流模式**：**语音模式**（推荐，带麦克风图标） / **文字模式**（键盘图标）。

  * **右侧：板子配置 (Dynamic Form)**

      * **人数选择**：6人 / 9人 / **12人(标准)**。
      * **板子预设 (Template)**：点击卡片快速选择。
          * *预女猎白*（标准）
          * *预女猎守*（进阶）
          * *生推局*（无神职）
      * **高级规则 (折叠收纳)**：
          * **女巫规则**：全程不可自救 / 仅首夜可自救。
          * **屠边/屠城**：选择获胜判定条件。
          * **发言时长**：60秒 / 90秒 / 120秒。
          * **遗言规则**：仅首夜 / 全程 / 无遗言。

  * **底部固定栏**

      * 显示当前配置摘要（例：“12人 · 语音 · 预女猎白”）。
      * **主按钮**：“创建并入座”。

-----

## 2\. 游戏房间界面布局 (The Arena)

**设计核心**：**信息可视化的层级管理**。任何时候，玩家必须一眼看清“谁在说话”、“谁死了”、“现在的阶段”。

### 2.1 桌面端布局 (Web Landscape)

采用**三栏式布局**，模拟“圆桌会议”视角。

  * **左侧栏 (20%)：局势记录 (Log)**
      * **Tab 1：对局日志**。系统自动生成的流水账（“天黑了”、“3号玩家死亡”）。
      * **Tab 2：记事本**。玩家私有的备注功能，可给每个号码打标签（如：金水、铁狼、民）。*这是硬核玩家刚需。*
  * **中央区域 (60%)：游戏圆桌**
      * **顶部**：阶段指示器（Phase Indicator）。显示当前阶段（如“天黑请闭眼 - 狼人行动中”）+ 倒计时进度条。
      * **圆桌座位**：12 个头像围绕中心排列。
          * **中心**：显示当前焦点内容（如：投票时的票型统计、被处决者的遗言动画、或当前发言者的放大立绘）。
  * **右侧栏 (20%)：操作与互动**
      * **顶部：我的角色卡**。点击可翻转查看详细技能描述。常驻显示底牌图标（仅自己可见）。
      * **中部：聊天流**。
          * *白天*：公共聊天。
          * *夜晚*：若为狼人，自动切换为“狼队频道”。
      * **底部：行动控制台**。根据阶段动态变化的按钮区（过麦、发动技能、投票）。

### 2.2 移动端布局 (H5 Portrait)

采用**上下分层布局**，类似主流狼人杀 App。

  * **顶部悬浮层**：倒计时 | 阶段提示 | 房间号。
  * **上部 (座位区)**：
      * 12个头像分为 3行×4列 或 4行×3列 排列。
      * 状态标记（警徽、死、麦克风状态）以角标形式挂在头像上。
  * **下部 (互动区)**：
      * **Tab 切换**：聊天 / 记录 / 笔记。
      * **底部常驻**：操作按钮（麦克风开关 / 技能释放）。

-----

## 3\. 核心功能交互流程 (The Gameplay Loop)

我们按照\*\*【等待】-\>【夜晚】-\>【白天】-\>【结算】\*\*的闭环来设计交互。

### 3.1 等待阶段 (Lobby)

  * **空位管理**：每个空座位显示“+”号。
      * 点击空位：弹出“邀请好友”或“添加电脑玩家(Bot)”。*（注：此处UI上显示为“添加电脑玩家”即可，不需要暴露复杂的AI性格配置，系统随机分配即可，保持简洁）。*
  * **准备机制**：房主点击“开始游戏”后，所有已准备玩家进入倒计时，未准备玩家自动踢出或转为观众。

### 3.2 夜晚阶段 (Night Phase) - 沉浸式暗黑模式

  * **视觉变化**：界面背景变暗，加上深蓝色滤镜，并在中央显示“天黑请闭眼”动效。
  * **行动逻辑 (根据身份不同而不同)**：
      * **平民**：屏幕显示“正在沉睡...”，无法操作，聊天区禁言。
      * **狼人**：
          * **视觉**：狼队友头像高亮显示，且标有狼爪图标。
          * **交互**：点击任意非狼玩家头像进行“指刀”。头像上出现一把带编号的小刀图标（如：3号头上出现“1”表示1号狼人想刀他）。
          * **统一**：当所有狼人选择一致或倒计时结束，锁定目标。
      * **女巫**：
          * 弹窗提示：“今晚他（显示头像/号码）死了，是否使用解药？” -\> [是] / [否]。
          * 若选否，界面进入选人毒杀模式，点击头像确认撒毒。
      * **预言家**：
          * 点击任意头像 -\> 确认查验。
          * 查验结果以卡片翻转动画形式展示给预言家（金水图标 或 查杀图标）。

### 3.3 白天阶段 (Day Phase)

  * **天亮公告**：
      * 系统广播：“天亮了”。
      * 公布昨夜死亡名单（若有）。死亡玩家头像变灰，并显示“墓碑”图标。
  * **竞选警长 (可选阶段)**：
      * UI 弹出：[参与竞选] / [退水] / [放弃]。
      * 上警玩家头像上有“举手”标记。
  * **顺序发言**：
      * **焦点模式**：当前发言玩家的头像会有**呼吸灯光圈**效果，且其麦克风图标跳动。
      * **其他玩家**：麦克风强制静音（除非插话模式开启）。
      * **操作**：当前玩家屏幕下方出现巨大的进度条和[结束发言]按钮。
  * **投票阶段**：
      * 屏幕中央弹出提示：“请投票”。
      * 除自己和死人外，所有存活玩家头像旁出现可点击的**投票框**。
      * **预操作**：点击头像后，目标头上显示“我的准星”，再次点击或倒计时结束确认。
      * **结果公示**：所有头像旁边显示他投给了谁（箭头指向）。

### 3.4 结算与复盘 (Game Over)

  * **胜利动画**：屏幕炸裂效果，“好人胜利”或“狼人胜利”的大字徽章。
  * **身份揭晓**：所有玩家头像翻转，露出底牌身份。
  * **高光时刻**：
      * MVP 评选（基于逻辑贡献或存活时间）。
      * **SVP (败方最佳)**。
  * **时间线复盘 (Timeline)**：
      * 以垂直时间轴展示全场关键操作：
          * *第1夜：狼人刀3号，女巫救3号。*
          * *第1天：5号当选警长。*
          * *第2夜：预言家查验8号（查杀）。*

-----

## 4\. 关键交互细节 (Micro-Interactions)

### 4.1 身份标记系统 (Identity Marking)

为了减轻记忆负担，这是线上狼人杀最重要的功能。

  * **操作方式**：长按/右键点击任意玩家头像。
  * **标记菜单**：弹出一个环形菜单，包含：
      * ❓ (未知/怀疑)
      * 🐺 (标狼)
      * 😇 (标好人/金水)
      * 🧙 (标神)
  * **显示**：标记的小图标会附着在该玩家头像的右上角，**仅自己可见**。

### 4.2 语音与状态反馈

  * **音量波形**：玩家发言时，头像周围要有随音量跳动的波纹，方便识别谁在说话。
  * **断线/托管**：如果玩家断开连接（WebSocket 心跳丢失），头像变暗并显示“离线”图标；若由 AI 接管，显示“托管中”。

-----

## 5\. 异常流程处理

  * **玩家掉线**：
      * 宽容期（30秒）：显示“断线重连中”。
      * 超时：系统自动接管（此时实际上是切换为最基础的规则型 AI，只会过麦和随机投票/弃票），避免卡死游戏进程。
  * **房主解散**：
      * 游戏进行中房主无法直接解散，必须通过全员投票或房主离开（房主权移交）。

-----

## 6\. 开发视角：数据结构简述 (前端状态)

为了实现上述 UI，前端需要维护一个核心 Store：

```typescript
interface GameState {
  phase: 'WAITING' | 'NIGHT' | 'DAY_DISCUSS' | 'DAY_VOTE' | 'GAME_END';
  subPhase: 'WOLF_ACTION' | 'SEER_ACTION' | ...; // 仅对自己相关的阶段有效
  timer: number; // 剩余秒数
  players: {
    [seatId: number]: {
      id: string;
      name: string;
      avatar: string;
      isAlive: boolean;
      isOnline: boolean;
      status: 'SPEAKING' | 'MUTED' | 'DEAD';
      marks: string[]; // 本地标记
    }
  };
  myRole: {
    role: 'WEREWOLF' | 'SEER' | ...;
    team: 'GOOD' | 'BAD';
    abilities: string[]; // 当前可用技能
  };
  log: LogEntry[]; // 历史记录
}
```

这份设计方案剥离了 AI 的复杂性，专注于构建一个**功能完备、交互清晰的标准化狼人杀对战平台**。AI 在此框架下，只是 `players` 数组中一个特殊的 `isBot: true` 的对象，其行为逻辑由后端驱动，前端无需感知差异。