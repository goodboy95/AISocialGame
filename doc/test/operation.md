# 系统功能与操作步骤（2026-02-18）

## 0. 入口与端口
1. 前端入口：`http://127.0.0.1:10030`（或 `http://aisocialgame.seekerhut.com`）。
2. 标准后端入口：`http://127.0.0.1:20030/api`。
3. 本机若遇到 Windows 端口排除策略（`WinError 10013`），先执行 `netsh interface ipv4 show excludedportrange protocol=tcp` 与 `netsh interface ipv6 show excludedportrange protocol=tcp`，确认 `20030` 不在排除区间后再启动后端。
4. 实时通道：`ws://<host>/ws`（通过域名统一访问）。

## 1. v2 导航与社交入口
1. 顶栏可见：`成就`、`回放`、`百科`、`快速开始`、`好友`。
2. 路由验证：
   - `/achievements`（成就中心）
   - `/replays`（回放列表）
   - `/replay/:archiveId`（回放播放器）
   - `/guide`（新手引导与规则百科）
   - `/spectate/:gameId/:roomId`（观战页）
3. 期望：页面可访问、无阻断错误，好友抽屉与快速匹配弹窗可正常打开。

## 2. 大厅到房间主路径
1. 打开首页 `/`，确认“热门游戏”列表可渲染。
2. 进入卧底房：`/room/undercover/{roomId}`。
3. 进入狼人房：`/room/werewolf/{roomId}`。
4. 期望：房间内可见阶段、玩家区、操作区、日志区、聊天区。

## 3. 房间聊天路径（重点）
1. 在卧底房聊天框输入功能匹配文本并提交，例如：`我先给关键词边界，等大家发言后再锁定卧底。`
2. 在狼人房聊天框输入功能匹配文本并提交，例如：`白天先记冲突，夜晚再结合身份做判断。`
3. 期望：
   - WebSocket 已连接时，聊天消息会直接出现在聊天区。
   - 若连接断开，页面展示“连接中断，正在自动重连...”，聊天发送会提示失败。

## 4. 对局动作路径（可继续回归）
1. 开局：点击“开始游戏”。
2. 发言阶段：填写发言并提交。
3. 投票阶段：点击头像选择目标，再确认投票。
4. 狼人夜晚阶段：按角色提交夜晚行动。
5. 结算阶段：出现结算揭示面板，可点击“加好友”。
6. 期望：动作后状态通过 WS 推送/状态拉取同步到页面。

## 5. 失效 token 回归点
1. 本地有失效 `aisocialgame_token` 时，进入房间不应长期卡在 `join 403`。
2. 若有 `room_player_{roomId}` 缓存，应能恢复座位并进入实时链路。
3. 期望：页面最终可进入房间并发送聊天消息。
